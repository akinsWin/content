id: 292dd7962657427a9d2ecdfd54253c5d
name: DNS RCE CVE-2020-1350
path: /Advanced Threat Detection/Windows Process Monitoring
description: ''
type: standard
author: community
entity_type: workbooks
blocks:
- type: text
  code: "|Author|References|\n                 |------|--------|\n               \
    \  |Florian Roth|https://research.checkpoint.com/2020/resolving-your-way-into-domain-admin-exploiting-a-17-year-old-bug-in-windows-dns-servers/<br>https://blog.menasec.net/2019/02/threat-hunting-24-microsoft-windows-dns.html|"
- type: sql
  query: SELECT $System, $ParentImage, $Image, $User FROM SYSMON-PROCESS WHERE ($ParentImage
    LIKE "%System32%dns%exe%" AND ($Image NOT LIKE "%System32%werfault%exe%" OR $Image
    NOT LIKE "%System32%conhost%exe%" OR $Image NOT LIKE "%System32%dnscmd%exe%"))
    AND $System IS NOT NULL AND $ParentImage IS NOT NULL AND $Image IS NOT NULL AND
    $User IS NOT NULL GROUP BY $System, $ParentImage, $Image, $User
- type: signal
  DetectionName: DNS RCE CVE-2020-1350
  DetectionTactic: Execution
  DetectionTechnique: System Services
  DetectionScore: '5'
  DetectionSeverity: Medium
  DetectionConfidence: Medium
  SuspectUser: $User
  TargetHost: $System
  raw_event_query: SELECT * FROM SYSMON-PROCESS WHERE ($ParentImage LIKE "%System32%dns%exe%"
    AND ($Image NOT LIKE "%System32%werfault%exe%" OR $Image NOT LIKE "%System32%conhost%exe%"
    OR $Image NOT LIKE "%System32%dnscmd%exe%")) AND $System IS NOT NULL AND $ParentImage
    IS NOT NULL AND $Image IS NOT NULL AND $User IS NOT NULL AND $System='TargetHost'
    AND $User='SuspectUser' LIMIT 1000
config: {}
