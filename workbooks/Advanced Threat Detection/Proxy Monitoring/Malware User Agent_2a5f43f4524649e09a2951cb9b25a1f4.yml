id: 2a5f43f4524649e09a2951cb9b25a1f4
name: Malware User Agent
path: /Advanced Threat Detection/Proxy Monitoring
description: Detects suspicious user agent strings used by malware in proxy logs
type: standard
author: community
entity_type: workbooks
blocks:
- type: text
  code: "|Author|References|\n                 |------|--------|\n               \
    \  |Florian Roth|http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules<br>http://www.botopedia.org/search?searchword=scan&searchphrase=all<br>https://networkraptor.blogspot.com/2015/01/user-agent-strings.html<br>https://perishablepress.com/blacklist/ua-2013.txt<br>https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents|"
- type: sql
  query: SELECT * FROM WEBFILTER WHERE ($UserAgent LIKE "Mozilla/5.0 (Windows NT 6.1;
    WOW64; rv:53.0) Gecko/20100101 Chrome /53.0" OR $UserAgent LIKE "Mozilla/4.0 (compatible;
    MSIE 8.0; Windows NT 5.1)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 7.0;
    Windows NT 5.1; Trident/4.0)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE
    6.0; Windows NT 5.0; .NET CLR  1.1.4322)" OR $UserAgent LIKE "HttpBrowser/1.0"
    OR $UserAgent LIKE "%<|>%" OR $UserAgent LIKE "nsis\_inetc (mozilla)" OR $UserAgent
    LIKE "Wget/1.9+cvs-stable (Red Hat modified)" OR $UserAgent LIKE "Mozilla/4.0
    (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)" OR $UserAgent
    LIKE "%zeroup%" OR $UserAgent LIKE "Mozilla/5.0 (Windows NT 5.1 ; v.%" OR $UserAgent
    LIKE "% adlib/%" OR $UserAgent LIKE "% tiny" OR $UserAgent LIKE "% BGroom %" OR
    $UserAgent LIKE "% changhuatong" OR $UserAgent LIKE "% CholTBAgent" OR $UserAgent
    LIKE "Mozilla/5.0 WinInet" OR $UserAgent LIKE "RookIE/1.0" OR $UserAgent LIKE
    "M" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)"
    OR $UserAgent LIKE "Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)" OR $UserAgent
    LIKE "backdoorbot" OR $UserAgent LIKE "Mozilla/5.0 (Windows; U; Windows NT 5.1;
    en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)" OR $UserAgent
    LIKE "Opera/8.81 (Windows NT 6.0; U; en)" OR $UserAgent LIKE "Mozilla/5.0 (Windows;
    U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)"
    OR $UserAgent LIKE "Opera" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 5.0;
    Windows 98)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT
    5.0)" OR $UserAgent LIKE "MSIE" OR $UserAgent LIKE "%(Charon; Inferno)" OR $UserAgent
    LIKE "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)" OR $UserAgent
    LIKE "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" OR $UserAgent LIKE "Mozilla/4.0(compatible;
    MSIE 6.0; Windows NT 5.1)" OR $UserAgent LIKE "Mozilla/5.0 (Windows NT 10.0; Win64;
    x64)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0;
    Win64; x64)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT
    6.1; Win64; x64)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 7.0; Windows
    NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)" OR $UserAgent LIKE
    "% pxyscand%" OR $UserAgent LIKE "% asd" OR $UserAgent LIKE "% mdms" OR $UserAgent
    LIKE "sample" OR $UserAgent LIKE "nocase" OR $UserAgent LIKE "Moxilla" OR $UserAgent
    LIKE "Win32 %" OR $UserAgent LIKE "%Microsoft Internet Explorer%" OR $UserAgent
    LIKE "agent %" OR $UserAgent LIKE "AutoIt" OR $UserAgent LIKE "IczelionDownLoad")
- type: signal
  DetectionName: Malware User Agent
  DetectionTactic: Command and Control
  DetectionTechnique: Application Layer Protocol
  DetectionScore: 5
  DetectionConfidence: Low
  SuspectHost: $SrcIP
  raw_event_query: SELECT * FROM WEBFILTER WHERE ($UserAgent LIKE "Mozilla/5.0 (Windows
    NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0" OR $UserAgent LIKE "Mozilla/4.0
    (compatible; MSIE 8.0; Windows NT 5.1)" OR $UserAgent LIKE "Mozilla/4.0 (compatible;
    MSIE 7.0; Windows NT 5.1; Trident/4.0)" OR $UserAgent LIKE "Mozilla/4.0 (compatible;
    MSIE 6.0; Windows NT 5.0; .NET CLR  1.1.4322)" OR $UserAgent LIKE "HttpBrowser/1.0"
    OR $UserAgent LIKE "%<|>%" OR $UserAgent LIKE "nsis\_inetc (mozilla)" OR $UserAgent
    LIKE "Wget/1.9+cvs-stable (Red Hat modified)" OR $UserAgent LIKE "Mozilla/4.0
    (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)" OR $UserAgent
    LIKE "%zeroup%" OR $UserAgent LIKE "Mozilla/5.0 (Windows NT 5.1 AND $SrcIP='{SuspectHost}'
    LIMIT 1000
config: {}
