id: 2278af4167bb4152b4080f37e4ac99f4
name: Exploit Framework User Agent
path: /Advanced Threat Detection/Proxy Monitoring
description: Detects suspicious user agent strings used by exploit / pentest framworks
  like Metasploit in proxy logs
type: standard
author: community
entity_type: workbooks
blocks:
- type: text
  code: "|Author|References|\n                 |------|--------|\n               \
    \  |Florian Roth|https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/|"
- type: sql
  query: SELECT * FROM WEBFILTER WHERE ($UserAgent LIKE "Internet Explorer %" OR $UserAgent
    LIKE "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)" OR
    $UserAgent LIKE "Mozilla/4.0 (compatible; Metasploit RSPEC)" OR $UserAgent LIKE
    "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)" OR $UserAgent LIKE "Mozilla/4.0
    (compatible; MSIE 6.0; Windows NT 5.1)" OR $UserAgent LIKE "Mozilla/4.0 (compatible;
    MSIE 7.0; Windows NT 6.0)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE 8.0;
    Windows NT 6.0; Trident/4.0)" OR $UserAgent LIKE "Mozilla/4.0 (compatible; MSIE
    7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E};
    SLCC1; .N" OR $UserAgent LIKE "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"
    OR $UserAgent LIKE "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13
    (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13" OR $UserAgent LIKE "Mozilla/5.0
    (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)" OR $UserAgent
    LIKE "Mozilla/5.0" OR $UserAgent LIKE "Mozilla/4.0 (compatible; SPIPE/1.0" OR
    $UserAgent LIKE "Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0"
    OR $UserAgent LIKE "Sametime Community Agent" OR $UserAgent LIKE "X-FORWARDED-FOR"
    OR $UserAgent LIKE "DotDotPwn v2.1" OR $UserAgent LIKE "SIPDROID" OR $UserAgent
    LIKE "Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)" OR $UserAgent LIKE "Mozilla/6.0
    (X11; Linux x86\_64; rv:24.0) Gecko/20140205     Firefox/27.0 Iceweasel/25.3.0"
    OR $UserAgent LIKE "%wordpress hash grabber%" OR $UserAgent LIKE "%exploit%")
- type: signal
  DetectionName: Exploit Framework User Agent
  DetectionTactic: Command and Control
  DetectionTechnique: Application Layer Protocol
  DetectionScore: 5
  DetectionConfidence: Low
  SuspectHost: $SrcIP
  raw_event_query: SELECT * FROM WEBFILTER WHERE $Duration=5m AND $SrcIP='SuspectHost'
    LIMIT 1000
config: {}
